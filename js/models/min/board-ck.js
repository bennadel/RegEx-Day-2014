app.factory("Board",function(n){function r(r,t){function e(n){if(h(),n){var r=[];if(angular.forEach(y,function(t){if("\\1"!==t.value){var e="^("+t.value+")",a=new RegExp(e,"i");a.test(n)&&r.push({pattern:e,parts:[t]})}}),r.length){do{var t=!1,e=[];angular.forEach(r,function(r){if(new RegExp("^"+r.pattern+"$","i").test(n))return e.push(r);var a=v(r.parts);angular.forEach(p(a.x,a.y),function(a){var u=x[a.x][a.y];if(u.value!=="\\"+(r.parts.length+1)){var f=r.pattern+"("+u.value+")",o=new RegExp(f,"i");c(r.parts,u)&&o.test(n)&&(e.push({pattern:f,parts:r.parts.concat(u)}),t=!0)}})}),r=e}while(t);angular.forEach(r,function(n){angular.forEach(n.parts,function(n){n.isSelected=!0})})}}}function a(){g++;for(var r=[],t=0,e=y.length;e>t;t++){var a=y[t];a.isSelected&&(r.push(a.value),x[a.x][a.y]={x:a.x,y:a.y,value:n.nextPattern(),isSelected:!1,round:g})}return y=o(),r}function u(){return y}function f(){for(var e=[],a=0;t>a;a++){e[a]=[];for(var u=0;r>u;u++)e[a][u]={x:a,y:u,value:n.nextPattern(),isSelected:!1,round:g}}return e}function o(){for(var n=[],e=0;t>e;e++)for(var a=0;r>a;a++)n.push(x[e][a]);return n}function i(n,r){for(var t=n.length,e=0,t=n.length;t>e;e++)if(n[e]===r)return!0;return!1}function c(n,r){return!i(n,r)}function p(n,r){var t=[];return l(n-1,r)&&t.push({x:n-1,y:r}),l(n+1,r)&&t.push({x:n+1,y:r}),l(n,r-1)&&t.push({x:n,y:r-1}),l(n,r+1)&&t.push({x:n,y:r+1}),t}function l(n,r){return!s(n,r)}function s(n,e){return 0>n||0>e||n>=t||e>=r}function v(n){return n[n.length-1]}function h(){for(var n=0;n<y.length;n++)y[n].isSelected=!1}var g=1,x=f(),y=o();return{applyInput:e,applySelection:a,asList:u}}return r});